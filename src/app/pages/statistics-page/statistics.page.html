<ion-header>
  <ion-toolbar>
    <ion-title>{{ 'statistics.title' | translate }}</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" *ngIf="spendingByCategoriesList$ | async as categories" scroll-y="false">

  <ng-container [formGroup]="periodFormGroup">
    <ion-radio-group formControlName="periodRange">
      <ion-item *ngFor="let period of periods">
        <ion-label>{{ period }}</ion-label>
        <ion-radio slot="end" [value]="period"></ion-radio>
      </ion-item>
    </ion-radio-group>
  </ng-container>

  <div class="doughnut-chart">
    <canvas baseChart
            class="chart"
            [data]="generateDoughnutChartData(categories)"
            [type]="'doughnut'"
            [options]="{ cutout: '80%', animation: false }"
    >
    </canvas>

    <div class="sum-select {{ selectedPeriod === 'week' && 'week' }}">
      <div class="sum">{{ currency$ | async }} {{ (totalAmount$ | async) | number: '.2' }}</div>

      <div class="select">
        <ion-select
          *ngIf="selectedPeriod === 'month'"
          interface="popover"
          [formControl]="monthControl"
          (ngModelChange)="onPeriodSelect('month')"
        >
          <ion-select-option *ngFor="let item of availableMonthsInCurrentYear" [value]="item">
            {{ 'general.months.' + item | translate }}
          </ion-select-option>
        </ion-select>

        <ion-select
          *ngIf="selectedPeriod === 'year'"
          interface="popover"
          [formControl]="yearControl"
          (ngModelChange)="onPeriodSelect('year')"
        >
          <ion-select-option *ngFor="let item of availableYears" [value]="item">{{ item }}</ion-select-option>
        </ion-select>
      </div>
    </div>
  </div>

  <ion-accordion-group>
    <p *ngIf="!categories.length" class="no-data-message">{{ 'general.messages.noData' | translate }}</p>

    <ion-accordion *ngFor="let category of categories; index as i" [value]=i>

      <ion-item slot="header" color="light">
        <ion-row>
          <div>
            <div class="icon-wrapper" [style.background-color]="category.icon.background">
              <ion-icon slot="icon-only" [name]="category.icon.iconType"></ion-icon>
            </div>

            <ion-label>{{ category.name }}</ion-label>
          </div>

          <ion-label>{{ currency$ | async }} {{ category.totalAmount | mrMoneyFormat }}</ion-label>
        </ion-row>
      </ion-item>

      <ion-list slot="content">
        <div
          *ngFor="let item of category.spendingList"
          [class.ion-page-hidden]="item.categoryId !== category.id"
          (click)="spendingService.spendingClickActionsModal(item, categoryList)"
        >
          <ion-label>
            <p *ngIf="item.description" class="spending-description">{{ item.description }}</p>

            <p class="spending-date">{{ item.date | date: 'MMM d, HH:mm' }}</p>
          </ion-label>

          <ion-label class="spending-amount">{{ currency$ | async }} {{ item.amount | mrMoneyFormat }}</ion-label>
        </div>
      </ion-list>

    </ion-accordion>
  </ion-accordion-group>
</ion-content>
